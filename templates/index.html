<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>هالستون | فروشگاه اینترنتی پوشاک</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* همان استایل قبلی */
        * { box-sizing: border-box; margin:0; padding:0; font-family: Vazirmatn, sans-serif; }
        body { background:#f5f5f5; color:#333; }
        header { background:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:1000; border-bottom:1px solid #ddd; }
        header h1 { font-size:1.5rem; cursor:pointer; }
        nav { display:flex; gap:10px; }
        nav button { background:none; border:none; cursor:pointer; font-size:1rem; padding:5px 10px; }
        nav button:hover { color:#007BFF; }
        .categories { position:absolute; top:60px; left:0; background:#fff; width:200px; border:1px solid #ddd; display:none; flex-direction:column; z-index:1001; }
        .categories.active { display:flex; }
        .categories button { padding:10px; text-align:right; border:none; background:none; cursor:pointer; }
        .categories button:hover { background:#f0f0f0; }

        #products { padding:20px; max-width:1200px; margin:auto; }
        #products-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:20px; }

        .product-card { background:#fff; border:1px solid #ddd; padding:10px; border-radius:5px; display:flex; flex-direction:column; justify-content:space-between; }
        .product-image { width:100%; height:180px; object-fit:cover; border-radius:5px; }
        .product-info { margin-top:10px; display:flex; flex-direction:column; gap:5px; }
        .product-name { font-weight:bold; font-size:1rem; }
        .product-price { color:#007BFF; font-weight:bold; }
        .product-actions { display:flex; justify-content:space-between; margin-top:5px; }
        .product-actions button { cursor:pointer; border:none; background:none; font-size:1rem; }
        .product-actions button.active i { color:red; }

        .quantity-selector { display:flex; justify-content:space-between; align-items:center; margin-top:5px; }
        .quantity-controls { display:flex; align-items:center; gap:5px; }
        .quantity-btn { cursor:pointer; border:1px solid #ccc; padding:2px 6px; background:#eee; }
        .quantity-input { width:40px; text-align:center; }

        .cart-btn { position:fixed; bottom:20px; left:20px; background:#007BFF; color:#fff; padding:10px 15px; border-radius:50px; cursor:pointer; z-index:1000; display:flex; align-items:center; gap:5px; }
        .cart-count { background:red; border-radius:50%; width:20px; height:20px; display:flex; align-items:center; justify-content:center; font-size:0.8rem; color:#fff; }

        #cart-popup { position:fixed; top:0; left:0; width:100%; height:100%; display:none; justify-content:center; align-items:center; z-index:1002; }
        #cart-popup.active { display:flex; }
        .cart-content { background:#fff; width:90%; max-width:500px; max-height:80%; overflow-y:auto; border-radius:5px; padding:20px; position:relative; }
        .cart-item { display:flex; gap:10px; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px; }
        .cart-item img { width:60px; height:60px; object-fit:cover; border-radius:5px; }
        .cart-item-details { flex:1; display:flex; flex-direction:column; justify-content:space-between; }
        .remove-item { align-self:flex-end; cursor:pointer; color:red; border:none; background:none; }
        #cart-total { font-weight:bold; margin-top:10px; text-align:right; }

        #overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; z-index:1001; }
        #overlay.active { display:block; }

        #user-info-modal { position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; padding:20px; width:90%; max-width:400px; border-radius:5px; display:none; flex-direction:column; gap:10px; z-index:1003; }
        #user-info-modal.active { display:flex; }

        input, textarea { width:100%; padding:8px; border:1px solid #ccc; border-radius:5px; }

        .view-all { text-decoration:none; color:#007BFF; font-size:0.8rem; }
    </style>
</head>
<body>
    <header>
        <h1 onclick="goToHome()">هالستون</h1>
        <nav>
            <button onclick="showAllProducts()">همه محصولات</button>
            <button onclick="toggleCategories()">دسته‌بندی‌ها</button>
            <button onclick="openUserInfoModal()">اطلاعات سفارش</button>
        </nav>
        <div class="categories" id="categories-menu">
            <button onclick="filterProducts('women')">زنانه</button>
            <button onclick="filterProducts('men')">مردانه</button>
            <button onclick="filterProducts('accessories')">اکسسوری</button>
        </div>
    </header>

    <section id="products">
        <div id="products-grid"></div>
    </section>

    <div class="cart-btn" onclick="toggleCart()">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count">0</span>
    </div>

    <div id="cart-popup">
        <div class="cart-content">
            <button onclick="closeCart()" style="position:absolute;top:10px;right:10px;border:none;background:none;font-size:1.2rem;">&times;</button>
            <div id="cart-items"></div>
            <div id="cart-total">0 تومان</div>
        </div>
    </div>

    <div id="overlay" onclick="closeAllModals()"></div>

    <div id="user-info-modal">
        <button onclick="closeUserInfoModal()" style="align-self:flex-end;border:none;background:none;font-size:1.2rem;">&times;</button>
        <h3>اطلاعات کاربر</h3>
        <form id="user-info-form" method="POST" action="send_order.php">
            <input type="text" name="name" placeholder="نام و نام خانوادگی" required>
            <input type="tel" name="phone" placeholder="شماره تماس" required>
            <textarea name="address" placeholder="آدرس" rows="3" required></textarea>
            <div id="order-items"></div>
            <button type="submit">ثبت سفارش</button>
        </form>
    </div>

    <script>
        function toggleCategories() { document.getElementById('categories-menu').classList.toggle('active'); }
        function closeCategories() { document.getElementById('categories-menu').classList.remove('active'); }
        function filterProducts(category) {
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                if(category==='all'||card.dataset.category===category) card.style.display='block';
                else card.style.display='none';
            });
            closeCategories();
        }
        function goToHome() { window.location.href='/'; }
        function showAllProducts() { filterProducts('all'); }

        let cart = JSON.parse(localStorage.getItem('cart'))||[];
        let wishlist = JSON.parse(localStorage.getItem('wishlist'))||[];

        function addToCart(code,name,price,image){
            const quantity=parseInt(document.getElementById(`quantity-${code}`).value)||1;
            const existing=cart.find(item=>item.id===code);
            if(existing) existing.quantity+=quantity;
            else cart.push({id:code,name,price,image,quantity});
            updateCart();
            alert(`"${name}" به سبد خرید اضافه شد!`);
        }

        function updateCart(){
            const cartCount=document.querySelector('.cart-count');
            const cartItems=document.getElementById('cart-items');
            const cartTotal=document.getElementById('cart-total');
            cartCount.textContent=cart.reduce((t,i)=>t+i.quantity,0);
            if(cart.length===0) cartItems.innerHTML='<div class="empty-cart">سبد خرید شما خالی است</div>';
            else cartItems.innerHTML=cart.map(item=>`
                <div class="cart-item">
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-item-details">
                        <div>${item.name}</div>
                        <div>${item.price.toLocaleString()} تومان</div>
                        <div class="cart-item-quantity">
                            <button onclick="changeQuantity('${item.id}',${item.quantity-1})">-</button>
                            <input type="number" value="${item.quantity}" min="1" onchange="changeQuantity('${item.id}',parseInt(this.value))">
                            <button onclick="changeQuantity('${item.id}',${item.quantity+1})">+</button>
                        </div>
                        <button class="remove-item" onclick="removeFromCart('${item.id}')">حذف</button>
                    </div>
                </div>
            `).join('');
            const total=cart.reduce((s,i)=>s+i.price*i.quantity,0);
            cartTotal.textContent=`${total.toLocaleString()} تومان`;
            localStorage.setItem('cart',JSON.stringify(cart));
        }

        function changeQuantity(id,newQ){ if(newQ<1)newQ=1; const item=cart.find(i=>i.id===id); if(item){item.quantity=newQ;updateCart();} }
        function removeFromCart(id){ cart=cart.filter(i=>i.id!==id); updateCart(); }
        function toggleCart(){ document.getElementById('cart-popup').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
        function closeCart(){ document.getElementById('cart-popup').classList.remove('active'); document.getElementById('overlay').classList.remove('active'); }

        function openUserInfoModal(){
            if(cart.length===0){ alert('سبد خرید شما خالی است!'); return; }
            const orderItems=document.getElementById('order-items'); orderItems.innerHTML='';
            cart.forEach(item=>{
                orderItems.innerHTML+=`
                    <input type="hidden" name="order_code[]" value="${item.id}">
                    <input type="hidden" name="order_count[]" value="${item.quantity}">
                `;
            });
            document.getElementById('user-info-modal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }
        function closeUserInfoModal(){ document.getElementById('user-info-modal').classList.remove('active'); document.getElementById('overlay').classList.remove('active'); }
        function closeAllModals(){ closeCart(); closeUserInfoModal(); closeCategories(); }

        function toggleWishlist(button,productId){
            const idx=wishlist.indexOf(productId);
            if(idx===-1) wishlist.push(productId);
            else wishlist.splice(idx,1);
            button.classList.toggle('active');
            localStorage.setItem('wishlist',JSON.stringify(wishlist));
        }

        function increaseProductQuantity(code){ const input=document.getElementById(`quantity-${code}`); input.value=parseInt(input.value)+1; }
        function decreaseProductQuantity(code){ const input=document.getElementById(`quantity-${code}`); input.value=Math.max(1,parseInt(input.value)-1); }

        const sampleProducts={
            "p1": {name:"پیراهن زنانه",price:120000,category:"women",image:"https://via.placeholder.com/200x180?text=p1",unit:"تومان"},
            "p2": {name:"کفش مردانه",price:250000,category:"men",image:"https://via.placeholder.com/200x180?text=p2",unit:"تومان"},
            "p3": {name:"گردنبند",price:80000,category:"accessories",image:"https://via.placeholder.com/200x180?text=p3",unit:"تومان"}
        };

        function displayProducts(products){
            const grid=document.getElementById('products-grid');
            grid.innerHTML='';
            for(const [code,product] of Object.entries(products)){
                grid.innerHTML+=`
                    <div class="product-card" data-category="${product.category}">
                        <img src="${product.image}" alt="${product.name}" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <div class="product-price">${product.price.toLocaleString()} ${product.unit}</div>
                            <div class="product-actions">
                                <button class="wishlist-btn" onclick="toggleWishlist(this,'${code}')"><i class="fas fa-heart"></i></button>
                                <button class="add-to-cart" onclick="addToCart('${code}','${product.name}',${product.price},'${product.image}')">
                                    <i class="fas fa-shopping-cart"></i> افزودن
                                </button>
                            </div>
                            <div class="quantity-selector">
                                <span>تعداد:</span>
                                <div class="quantity-controls">
                                    <button onclick="decreaseProductQuantity('${code}')">-</button>
                                    <input type="number" id="quantity-${code}" class="quantity-input" value="1" min="1">
                                    <button onclick="increaseProductQuantity('${code}')">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        displayProducts(sampleProducts);
        updateCart();
    </script>
</body>
</html>
