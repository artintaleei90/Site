<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>هالستون | فروشگاه پوشاک</title>
<style>
/* =================== CSS =================== */
:root {
    --primary-color:#e52733;
    --secondary-color:#333;
    --light-color:#f8f9fa;
    --gray-color:#6c757d;
    --border-color:#dee2e6;
    --background-color:#f5f5f5;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Tahoma,Arial,sans-serif;}
body{background:var(--background-color);color:#333;line-height:1.6;}
.container{max-width:1200px;margin:0 auto;padding:0 15px;}
header{background:white;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
.top-header{background:#f5f5f5;padding:8px 0;font-size:0.85rem;border-bottom:1px solid var(--border-color);}
.top-header .container{display:flex;justify-content:space-between;align-items:center;}
.main-header{padding:15px 0;display:flex;justify-content:space-between;align-items:center;}
.logo{font-size:24px;font-weight:bold;color:var(--primary-color);cursor:pointer;}
.header-actions{display:flex;gap:20px;align-items:center;}
.cart-wrapper{position:relative;cursor:pointer;}
.cart-count{position:absolute;top:-5px;right:-5px;background:var(--primary-color);color:white;border-radius:50%;width:18px;height:18px;display:flex;justify-content:center;align-items:center;font-size:0.7rem;}
.products-section{padding:40px 0;background:white;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.05);margin:20px;}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:1px solid var(--border-color);}
.section-title{font-size:1.5rem;color:var(--secondary-color);}
.products-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;}
.product-card{background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.08);transition:transform 0.3s,box-shadow 0.3s;position:relative;}
.product-card:hover{transform:translateY(-5px);box-shadow:0 8px 20px rgba(0,0,0,0.12);}
.product-image{width:100%;height:220px;object-fit:cover;}
.product-info{padding:15px;}
.product-name{font-size:0.95rem;margin-bottom:10px;height:44px;overflow:hidden;line-height:1.4;}
.price{font-weight:bold;color:var(--primary-color);font-size:1.1rem;}
.add-to-cart{background:var(--primary-color);color:white;border:none;border-radius:4px;padding:8px 12px;cursor:pointer;transition:background 0.3s;}
.add-to-cart:hover{background:#c41f29;}
.cart-popup{position:fixed;top:0;right:0;width:350px;height:100vh;background:white;box-shadow:-5px 0 15px rgba(0,0,0,0.1);z-index:1000;padding:20px;overflow-y:auto;transform:translateX(100%);transition:transform 0.3s;}
.cart-popup.active{transform:translateX(0);}
.cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid var(--border-color);}
.close-cart{background:none;border:none;font-size:1.2rem;cursor:pointer;}
.cart-items{margin-bottom:20px;}
.cart-item{display:flex;margin-bottom:15px;padding-bottom:15px;border-bottom:1px solid var(--border-color);}
.cart-item-image{width:70px;height:70px;object-fit:cover;border-radius:4px;margin-left:10px;}
.cart-item-details{flex-grow:1;}
.cart-item-name{font-size:0.9rem;font-weight:500;margin-bottom:5px;}
.cart-item-price{color:var(--primary-color);font-weight:bold;font-size:0.9rem;}
.cart-item-quantity{display:flex;align-items:center;margin-top:5px;}
.remove-item{background:none;border:none;color:var(--primary-color);cursor:pointer;font-size:0.85rem;margin-top:5px;}
.cart-total{display:flex;justify-content:space-between;font-weight:bold;margin-bottom:15px;font-size:1rem;}
.checkout-btn{display:block;width:100%;text-align:center;padding:10px;background:var(--primary-color);color:white;border-radius:4px;cursor:pointer;text-decoration:none;}
.checkout-btn:hover{background:#c41f29;}
.modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:white;width:90%;max-width:400px;padding:20px;z-index:1100;border-radius:8px;transition:transform 0.3s;}
.modal.active{transform:translate(-50%,-50%) scale(1);}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
.close-modal{background:none;border:none;font-size:1.2rem;cursor:pointer;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:100;display:none;}
.overlay.active{display:block;}
.modal form input, .modal form textarea{width:100%;padding:10px;margin-bottom:10px;border:1px solid var(--border-color);border-radius:4px;}
.modal form button{width:100%;padding:10px;background:var(--primary-color);color:white;border:none;border-radius:4px;cursor:pointer;font-size:1rem;}
.modal form button:hover{background:#c41f29;}
@media(max-width:1024px){.products-grid{grid-template-columns:repeat(3,1fr);}}
@media(max-width:768px){.products-grid{grid-template-columns:repeat(2,1fr);}}
@media(max-width:480px){.products-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="overlay" id="overlay" onclick="closeAllModals()"></div>

<header class="top-header">
<div class="container">
    <div>تماس با ما: 09123456789</div>
    <div>ارسال رایگان بالای ۵۰۰ هزار تومان</div>
</div>
</header>

<header class="main-header container">
<div class="logo">Halston</div>
<div class="header-actions">
    <div class="cart-wrapper" onclick="toggleCart()">
        🛒
        <div class="cart-count" id="cart-count">0</div>
    </div>
</div>
</header>

<section class="products-section container">
<div class="section-header">
    <h2 class="section-title">محصولات</h2>
</div>
<div class="products-grid" id="products-grid"></div>
</section>

<!-- سبد خرید -->
<div class="cart-popup" id="cart-popup">
<div class="cart-header">
    <h3>سبد خرید</h3>
    <button class="close-cart" onclick="closeCart()">✖</button>
</div>
<div class="cart-items" id="cart-items"></div>
<div class="cart-total">
    <span>جمع کل:</span>
    <span id="cart-total">0 تومان</span>
</div>
<button class="checkout-btn" onclick="openUserInfoModal()">ثبت سفارش</button>
</div>

<!-- مودال اطلاعات کاربر -->
<div class="modal" id="user-info-modal">
<div class="modal-header">
    <h3>اطلاعات مشتری</h3>
    <button class="close-modal" onclick="closeUserInfoModal()">✖</button>
</div>
<form onsubmit="event.preventDefault(); generateInvoice();">
    <input type="text" id="name" placeholder="نام و نام خانوادگی" required>
    <input type="text" id="phone" placeholder="شماره تماس" required>
    <textarea id="address" placeholder="آدرس" rows="3" required></textarea>
    <button type="submit">تولید فاکتور</button>
</form>
</div>

<script>
/* =================== JS =================== */
const products = [
    {id:1,name:"پیراهن زنانه",price:150000,img:"https://via.placeholder.com/300x300?text=Shirt"},
    {id:2,name:"شلوار جین",price:200000,img:"https://via.placeholder.com/300x300?text=Jeans"},
    {id:3,name:"کفش اسپرت",price:250000,img:"https://via.placeholder.com/300x300?text=Shoes"},
    {id:4,name:"سویشرت",price:180000,img:"https://via.placeholder.com/300x300?text=Sweatshirt"}
];

let cart = [];

function renderProducts(){
    const grid = document.getElementById("products-grid");
    grid.innerHTML="";
    products.forEach(p=>{
        const div = document.createElement("div");
        div.className="product-card";
        div.innerHTML=`
            <img class="product-image" src="${p.img}">
            <div class="product-info">
                <div class="product-name">${p.name}</div>
                <div class="price">${p.price.toLocaleString()} تومان</div>
                <button class="add-to-cart" onclick="addToCart(${p.id})">افزودن به سبد</button>
            </div>
        `;
        grid.appendChild(div);
    });
}

function addToCart(id){
    const product = products.find(p=>p.id===id);
    const exist = cart.find(item=>item.id===id);
    if(exist) exist.quantity+=1;
    else cart.push({...product,quantity:1});
    updateCart();
}

function updateCart(){
    const container = document.getElementById("cart-items");
    container.innerHTML="";
    let total=0;
    cart.forEach(item=>{
        total+=item.price*item.quantity;
        const div=document.createElement("div");
        div.className="cart-item";
        div.innerHTML=`
            <img class="cart-item-image" src="${item.img}">
            <div class="cart-item-details">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-price">${item.price.toLocaleString()} تومان</div>
                <div class="cart-item-quantity">تعداد: ${item.quantity}</div>
                <button class="remove-item" onclick="removeFromCart(${item.id})">حذف</button>
            </div>
        `;
        container.appendChild(div);
    });
    document.getElementById("cart-count").innerText=cart.length;
    document.getElementById("cart-total").innerText=total.toLocaleString()+" تومان";
}

function removeFromCart(id){
    cart=cart.filter(item=>item.id!==id);
    updateCart();
}

function toggleCart(){
    document.getElementById("cart-popup").classList.toggle("active");
}

function closeCart(){
    document.getElementById("cart-popup").classList.remove("active");
}

function openUserInfoModal(){
    if(cart.length===0){alert("سبد خرید خالی است!");return;}
    document.getElementById("user-info-modal").classList.add("active");
    document.getElementById("overlay").classList.add("active");
}

function closeUserInfoModal(){
    document.getElementById("user-info-modal").classList.remove("active");
    document.getElementById("overlay").classList.remove("active");
}

function closeAllModals(){
    closeUserInfoModal();
}

function generateInvoice(){
    const name=document.getElementById("name").value;
    const phone=document.getElementById("phone").value;
    const address=document.getElementById("address").value;
    if(!name||!phone||!address){alert("لطفاً تمام فیلدها را پر کنید!"); return;}
    let invoiceHTML=`<h2>فاکتور خرید</h2><p>نام: ${name}<br>تلفن: ${phone}<br>آدرس: ${address}</p><table><tr><th>محصول</th><th>تعداد</th><th>قیمت</th></tr>`;
    cart.forEach(item=>{
        invoiceHTML+=`<tr><td>${item.name}</td><td>${item.quantity}</td><td>${(item.price*item.quantity).toLocaleString()}</td></tr>`;
    });
    const total = cart.reduce((sum,i)=>sum+i.price*i.quantity,0);
    invoiceHTML+=`<tr><th colspan="2">جمع کل</th><th>${total.toLocaleString()}</th></tr></table>`;
    const w = window.open("","_blank");
    w.document.write(invoiceHTML);
    w.document.close();
    w.print();
    // ارسال به سرور
    fetch("/create_order",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,phone,address,cart,total})
    }).then(res=>res.json()).then(data=>{
        alert("سفارش شما ثبت شد!");
        cart=[];
        updateCart();
        closeUserInfoModal();
    });
}

renderProducts();
</script>
</body>
</html>
