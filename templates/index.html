<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فروشگاه هالستون</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- هدر -->
    <header class="header">
        <div class="logo">🌸 هالستون شاپ</div>
        <div class="cart-icon" onclick="openCart()">
            🛒 <span id="cart-count">۰</span>
        </div>
    </header>

    <!-- بخش محصولات -->
    <main>
        {% for category, items in products.items() %}
        <section class="category-section">
            <h2 class="category-title">{{ category }}</h2>
            <div class="slider-container">
                <button class="slider-btn left" onclick="slideLeft('{{ loop.index }}')">‹</button>
                <div id="slider-{{ loop.index }}" class="products-slider">
                    {% for item in items %}
                    <div class="product-card">
                        <img src="{{ item.image }}" alt="{{ item.name }}">
                        <h3>{{ item.name }}</h3>
                        <p class="price">{{ "{:,}".format(item.price) }} تومان</p>
                        <button onclick="addToCart('{{ item.code }}', '{{ item.name }}', '{{ item.price }}')">افزودن به سبد</button>
                    </div>
                    {% endfor %}
                </div>
                <button class="slider-btn right" onclick="slideRight('{{ loop.index }}')">›</button>
            </div>
        </section>
        {% endfor %}
    </main>

    <!-- سبد خرید -->
    <div id="cart-modal" class="cart-modal">
        <div class="cart-content">
            <h2>🛍️ سبد خرید شما</h2>
            <ul id="cart-items"></ul>
            <div class="cart-footer">
                <p>جمع کل: <span id="total-price">۰</span> تومان</p>
                <button id="checkout-btn" onclick="checkout()">ثبت سفارش</button>
                <button class="close-btn" onclick="closeCart()">بستن</button>
            </div>
        </div>
    </div>

    <script>
        let cart = [];

        function addToCart(code, name, price) {
            cart.push({ code, name, price: parseInt(price) });
            document.getElementById("cart-count").innerText = cart.length;
            renderCart();
        }

        function renderCart() {
            const cartList = document.getElementById("cart-items");
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            cartList.innerHTML = "";
            cart.forEach(item => {
                const li = document.createElement("li");
                li.innerHTML = `${item.name} - ${item.price.toLocaleString()} تومان`;
                cartList.appendChild(li);
            });
            document.getElementById("total-price").innerText = total.toLocaleString();
        }

        function openCart() {
            document.getElementById("cart-modal").style.display = "flex";
        }

        function closeCart() {
            document.getElementById("cart-modal").style.display = "none";
        }

        function checkout() {
            fetch("/checkout", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ cart })
            })
            .then(res => res.json())
            .then(data => {
                alert("✅ سفارش شما ثبت شد و فاکتور به تلگرام ارسال شد!");
                cart = [];
                document.getElementById("cart-count").innerText = "۰";
                renderCart();
                closeCart();
            });
        }

        function slideLeft(id) {
            document.getElementById("slider-" + id).scrollBy({ left: -300, behavior: "smooth" });
        }

        function slideRight(id) {
            document.getElementById("slider-" + id).scrollBy({ left: 300, behavior: "smooth" });
        }
    </script>
</body>
</html>
