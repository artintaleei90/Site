<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Halston Shop</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header class="site-header">
    <div class="topbar">
        <div class="container">
            <div class="left">ğŸ“ 0912-888-3343</div>
            <div class="right">
                <button id="favorites-btn" class="link-btn">â¤ï¸ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</button>
                <button id="cart-open-btn" class="link-btn">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ <span id="cart-badge" class="badge">0</span></button>
            </div>
        </div>
    </div>
    <div class="main-header container">
        <div class="logo">Halston</div>
        <div class="search-wrap">
            <input id="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª..." />
            <button id="search-btn">ğŸ”</button>
        </div>
    </div>
</header>

<section class="hero container" id="hero">
    <div class="slides">
        <div class="slide active" style="background-image:url('https://raw.githubusercontent.com/artintaleei90/Site/main/slider1.jpeg')">
            <div class="hero-text"><h1>Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª</h1><p>Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ Ø¯Ø± Halston</p></div>
        </div>
        <div class="slide" style="background-image:url('https://raw.githubusercontent.com/artintaleei90/Site/main/slider2.jpeg')">
            <div class="hero-text"><h1>ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡</h1><p>Ù‡Ù…ÛŒÙ† Ø­Ø§Ù„Ø§ Ø³ÙØ§Ø±Ø´ Ø¯Ù‡ÛŒØ¯</p></div>
        </div>
    </div>
    <button class="hero-nav prev" id="hero-prev">â€¹</button>
    <button class="hero-nav next" id="hero-next">â€º</button>
</section>

<main class="container">
    <div id="categories-container"></div>
</main>

<div id="overlay" class="overlay hidden"></div>
<aside id="cart-drawer" class="cart-drawer hidden">
    <header class="drawer-header">
        <h3>ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h3>
        <button id="cart-close">âœ•</button>
    </header>
    <div class="drawer-body" id="cart-items"></div>
    <footer class="drawer-footer">
        <div id="cart-summary">Ø¬Ù…Ø¹ Ú©Ù„: 0 ØªÙˆÙ…Ø§Ù†</div>
        <button id="view-invoice" class="primary">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§Ú©ØªÙˆØ±</button>
    </footer>
</aside>

<div id="invoice-modal" class="modal hidden">
    <div class="modal-inner">
        <header><h3>ÙØ§Ú©ØªÙˆØ± Ø®Ø±ÛŒØ¯</h3><button id="close-invoice">âœ•</button></header>
        <div class="modal-body">
            <div class="customer-form">
                <input id="cust-name" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" />
                <input id="cust-phone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³" />
                <input id="cust-city" placeholder="Ø´Ù‡Ø±" />
                <textarea id="cust-address" placeholder="Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„"></textarea>
            </div>
            <div class="invoice-preview">
                <iframe id="invoice-frame" style="width:100%;height:420px;border:0;"></iframe>
            </div>
        </div>
        <footer>
            <button id="send-invoice-btn" class="primary">Ø§Ø±Ø³Ø§Ù„ Ùˆ Ù†Ù‡Ø§ÛŒÛŒ</button>
        </footer>
    </div>
</div>

<script>
const productsByCode = {};
let categories = {};
let cart = {};

const categoriesContainer = document.getElementById('categories-container');
const cartBadge = document.getElementById('cart-badge');
const overlay = document.getElementById('overlay');
const cartDrawer = document.getElementById('cart-drawer');
const cartItemsEl = document.getElementById('cart-items');
const cartSummaryEl = document.getElementById('cart-summary');

const invoiceModal = document.getElementById('invoice-modal');
const invoiceFrame = document.getElementById('invoice-frame');
const sendInvoiceBtn = document.getElementById('send-invoice-btn');

async function loadProducts(){
    const res = await fetch('/api/products');
    const data = await res.json();
    categories = {};
    for(const code in data){
        const p = data[code];
        productsByCode[code] = {...p, code};
        const cat = p.category || 'all';
        if(!categories[cat]) categories[cat] = [];
        categories[cat].push({...p, code});
    }
    renderCategories();
}

function renderCategories(){
    categoriesContainer.innerHTML = '';
    for(const cat in categories){
        const row = document.createElement('section');
        row.className = 'category-row';
        row.innerHTML = `
            <div class="row-header">
                <h3>${cat === 'all' ? 'Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª' : cat}</h3>
                <div class="row-controls">
                    <button class="scroll-left">â€¹</button>
                    <button class="scroll-right">â€º</button>
                </div>
            </div>
            <div class="row-content"></div>
        `;
        const content = row.querySelector('.row-content');
        categories[cat].forEach(p => {
            const card = document.createElement('article');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="p-image"><img src="${p.image}" alt="${p.name}"></div>
                <div class="p-body">
                    <h4 class="p-title">${p.name}</h4>
                    <div class="p-price">${Number(p.price).toLocaleString()} ØªÙˆÙ…Ø§Ù†</div>
                    <div class="p-actions">
                        <button class="btn-details" data-code="${p.code}">Ø¬Ø²Ø¦ÛŒØ§Øª</button>
                        <button class="btn-add" data-code="${p.code}">Ø§ÙØ²ÙˆØ¯Ù†</button>
                    </div>
                </div>
            `;
            content.appendChild(card);
        });
        row.querySelector('.scroll-left').addEventListener('click', ()=> content.scrollBy({left: -360, behavior: 'smooth'}));
        row.querySelector('.scroll-right').addEventListener('click', ()=> content.scrollBy({left: 360, behavior: 'smooth'}));
        categoriesContainer.appendChild(row);
    }
    bindButtons();
}

function bindButtons(){
    document.querySelectorAll('.btn-add').forEach(btn=>{
        btn.addEventListener('click', e=>{
            const code = e.currentTarget.dataset.code;
            const qty = parseInt(prompt("ØªØ¹Ø¯Ø§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:", "1"));
            if(!isNaN(qty) && qty>0) addToCart(code, qty);
        });
    });
    document.querySelectorAll('.btn-details').forEach(btn=>{
        btn.addEventListener('click', e=>{
            const code = e.currentTarget.dataset.code;
            const p = productsByCode[code];
            alert(`${p.name}\nÙ‚ÛŒÙ…Øª: ${Number(p.price).toLocaleString()} ØªÙˆÙ…Ø§Ù†`);
        });
    });
}

function addToCart(code, qty=1){
    if(cart[code]) cart[code] += qty; else cart[code]=qty;
    updateCartUI();
    toast("Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯");
}

function updateCartUI(){
    const count = Object.values(cart).reduce((a,b)=>a+b,0);
    cartBadge.textContent = count;
    cartItemsEl.innerHTML = '';
    let total=0;
    for(const code in cart){
        const p = productsByCode[code];
        const qty = cart[code];
        const item = document.createElement('div');
        item.className = 'cart-row';
        item.innerHTML = `
            <img src="${p.image}" alt="${p.name}">
            <div class="info">
                <div class="name">${p.name}</div>
                <div class="meta">${Number(p.price).toLocaleString()} Ã— ${qty} = ${Number(p.price*qty).toLocaleString()} ØªÙˆÙ…Ø§Ù†</div>
                <div class="controls">
                    <button class="dec" data-code="${code}">-</button>
                    <span class="qty">${qty}</span>
                    <button class="inc" data-code="${code}">+</button>
                    <button class="remove" data-code="${code}">Ø­Ø°Ù</button>
                </div>
            </div>
        `;
        cartItemsEl.appendChild(item);
        total += p.price*qty;
    }
    cartSummaryEl.textContent = `Ø¬Ù…Ø¹ Ú©Ù„: ${Number(total).toLocaleString()} ØªÙˆÙ…Ø§Ù†`;

    cartItemsEl.querySelectorAll('.inc').forEach(b=>b.addEventListener('click', e=>{cart[e.currentTarget.dataset.code]+=1; updateCartUI();}));
    cartItemsEl.querySelectorAll('.dec').forEach(b=>b.addEventListener('click', e=>{const code=e.currentTarget.dataset.code; cart[code]>1?cart[code]-=1:delete cart[code]; updateCartUI();}));
    cartItemsEl.querySelectorAll('.remove').forEach(b=>b.addEventListener('click', e=>{delete cart[e.currentTarget.dataset.code]; updateCartUI();}));
}

document.getElementById('cart-open-btn').addEventListener('click', ()=>{cartDrawer.classList.remove('hidden');overlay.classList.remove('hidden');});
document.getElementById('cart-close').addEventListener('click', ()=>{cartDrawer.classList.add('hidden');overlay.classList.add('hidden');});
overlay.addEventListener('click', ()=>{cartDrawer.classList.add('hidden');invoiceModal.classList.add('hidden');overlay.classList.add('hidden');invoiceFrame.src='';});

document.getElementById('view-invoice').addEventListener('click', ()=>{if(Object.keys(cart).length===0){alert("Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª");return;}invoiceModal.classList.remove('hidden');overlay.classList.remove('hidden');});
document.getElementById('close-invoice').addEventListener('click', ()=>{invoiceModal.classList.add('hidden');overlay.classList.add('hidden');invoiceFrame.src='';});

sendInvoiceBtn.addEventListener('click', async ()=>{
    const name=document.getElementById('cust-name').value.trim();
    const phone=document.getElementById('cust-phone').value.trim();
    const city=document.getElementById('cust-city').value.trim();
    const address=document.getElementById('cust-address').value.trim();
    if(!name||!phone||!address){alert("Ù„Ø·ÙØ§ Ù†Ø§Ù…ØŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ùˆ Ø¢Ø¯Ø±Ø³ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯.");return;}
    // Ø§ÛŒØ¬Ø§Ø¯ PDF ÛŒØ§ Ù†Ù…Ø§ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø¯Ø± iframe
    invoiceFrame.src = `/invoice?name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}&city=${encodeURIComponent(city)}&address=${encodeURIComponent(address)}`;
});

function toast(msg){
    let t = document.createElement('div');
    t.className='toast visible';
    t.textContent=msg;
    document.body.appendChild(t);
    setTimeout(()=>t.remove(),1500);
}

loadProducts();
</script>
</body>
</html>
