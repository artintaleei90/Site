<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halston Shop</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- ================= Header ================= -->
<header>
    <div class="top-header">
        <span>تماس با ما: 09128883343</span>
        <div>
            <a href="#" id="favorites-btn">❤️ علاقه‌مندی‌ها</a>
            <a href="#" id="cart-btn">🛒 سبد خرید <span class="cart-count" id="cart-count">0</span></a>
        </div>
    </div>
    <div class="main-header">
        <div class="logo">Halston Shop</div>
        <div class="search-bar">
            <input type="text" placeholder="جستجو...">
            <button>🔍</button>
        </div>
    </div>
</header>

<!-- ================= Hero Slider ================= -->
<section class="hero-slider">
    <div class="hero-slide active" style="background-image:url('https://raw.githubusercontent.com/artintaleei90/Site/main/slider1.jpeg');">
        <div class="slide-content">
            <h2>جدیدترین محصولات</h2>
            <p>بهترین انتخاب‌ها در Halston Shop</p>
        </div>
    </div>
    <div class="hero-slide" style="background-image:url('https://raw.githubusercontent.com/artintaleei90/Site/main/slider2.jpeg');">
        <div class="slide-content">
            <h2>تخفیف ویژه</h2>
            <p>همین حالا سفارش دهید و از تخفیف‌ها استفاده کنید!</p>
        </div>
    </div>
    <button class="nav-btn prev-btn">❮</button>
    <button class="nav-btn next-btn">❯</button>
</section>

<!-- ================= Products ================= -->
<section class="products-section">
    <div class="section-header">
        <h2 class="section-title">محصولات</h2>
    </div>
    <div class="products-grid" id="products-grid">
        <!-- محصولات با JS از /api/products لود می‌شوند -->
    </div>
</section>

<!-- ================= Modal ================= -->
<div class="overlay" id="overlay"></div>
<div class="modal" id="product-modal">
    <h3 id="modal-title">عنوان محصول</h3>
    <img id="modal-image" src="" alt="" style="width:100%; border-radius:6px; margin-bottom:10px;">
    <p id="modal-desc">توضیحات محصول</p>
    <label for="modal-quantity">تعداد:</label>
    <input type="number" id="modal-quantity" value="1" min="1">
    <button id="modal-add">افزودن به سبد خرید</button>
</div>

<!-- ================= Scripts ================= -->
<script>
let products = {};
let cart = {};

const productsGrid = document.getElementById('products-grid');
const overlay = document.getElementById('overlay');
const modal = document.getElementById('product-modal');
const modalTitle = document.getElementById('modal-title');
const modalImage = document.getElementById('modal-image');
const modalDesc = document.getElementById('modal-desc');
const modalQuantity = document.getElementById('modal-quantity');
const modalAdd = document.getElementById('modal-add');
const cartCount = document.getElementById('cart-count');
let currentProduct = null;

// دریافت محصولات از main.py
fetch('/api/products')
.then(res => res.json())
.then(data => {
    products = data;
    renderProducts();
});

function renderProducts() {
    productsGrid.innerHTML = '';
    for (let code in products) {
        const p = products[code];
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
            <img class="product-image" src="${p.image}" alt="${p.name}">
            <div class="product-info">
                <div class="product-name">${p.name}</div>
                <div class="product-price">${p.price} تومان</div>
                <div class="product-actions">
                    <button class="add-to-cart">افزودن</button>
                </div>
            </div>
        `;
        card.querySelector('.product-image').addEventListener('click', () => openModal(code));
        card.querySelector('.add-to-cart').addEventListener('click', () => openModal(code));
        productsGrid.appendChild(card);
    }
}

function openModal(code) {
    currentProduct = code;
    const p = products[code];
    modalTitle.textContent = p.name;
    modalImage.src = p.image;
    modalDesc.textContent = p.name; // توضیحات کوتاه
    modalQuantity.value = 1;
    modal.classList.add('active');
    overlay.classList.add('active');
}

function closeModal() {
    modal.classList.remove('active');
    overlay.classList.remove('active');
}

overlay.addEventListener('click', closeModal);
modalAdd.addEventListener('click', () => {
    const qty = parseInt(modalQuantity.value);
    if (cart[currentProduct]) cart[currentProduct] += qty;
    else cart[currentProduct] = qty;
    cartCount.textContent = Object.values(cart).reduce((a,b)=>a+b,0);
    closeModal();
});

// چاپ فاکتور
function printInvoice() {
    const name = prompt("نام خود را وارد کنید:");
    const phone = prompt("شماره تماس:");
    const address = prompt("آدرس:");
    const cartArray = [];
    for (let code in cart) {
        cartArray.push({code: code, count: cart[code]});
    }
    fetch('/api/order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name, phone, address, cart: cartArray})
    }).then(res => res.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'invoice.pdf';
        a.click();
    });
}
</script>

<!-- ================= Cart Print Button ================= -->
<div style="position:fixed; bottom:20px; left:20px; z-index:1002;">
    <button onclick="printInvoice()" style="background: #e91e63; color:white; border:none; padding:12px 20px; border-radius:8px; font-size:1rem; cursor:pointer;">چاپ فاکتور</button>
</div>

</body>
</html>
