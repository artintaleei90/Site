<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>هالستون | فروشگاه اینترنتی پوشاک</title>
<style>
:root {--primary-color:#e52733;--secondary-color:#333;--light-color:#f8f9fa;--gray-color:#6c757d;--border-color:#dee2e6;--background-color:#f5f5f5;}
*{margin:0;padding:0;box-sizing:border-box;font-family:Tahoma, Arial, sans-serif;}
body{background:var(--background-color);color:#333;line-height:1.6;}
.container{max-width:1200px;margin:0 auto;padding:0 15px;}
.top-header{background:#f5f5f5;border-bottom:1px solid var(--border-color);padding:8px 0;font-size:0.85rem;}
.top-header .container{display:flex;justify-content:space-between;align-items:center;}
.top-header-links{display:flex;gap:20px;}
.top-header-links a{color:var(--gray-color);text-decoration:none;cursor:pointer;}
.top-header-links a:hover{color:var(--primary-color);}
.main-header{background:white;padding:15px 0;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
.main-header .container{display:flex;justify-content:space-between;align-items:center;}
.logo{font-size:24px;font-weight:bold;color:var(--primary-color);cursor:pointer;}
.search-bar{flex-grow:1;margin:0 20px;position:relative;max-width:500px;}
.search-bar input{width:100%;padding:10px 40px 10px 15px;border:1px solid var(--border-color);border-radius:4px;font-size:0.9rem;}
.search-bar button{position:absolute;left:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--gray-color);cursor:pointer;}
.header-actions{display:flex;gap:20px;align-items:center;}
.header-action{display:flex;flex-direction:column;align-items:center;cursor:pointer;}
.header-action span{margin-bottom:5px;font-size:1.2rem;}
.cart-wrapper{position:relative;}
.cart-count{position:absolute;top:-5px;right:-5px;background-color:var(--primary-color);color:white;border-radius:50%;width:18px;height:18px;font-size:0.7rem;display:flex;justify-content:center;align-items:center;}
.main-nav{background-color:var(--primary-color);}
.main-nav .container{display:flex;justify-content:space-between;align-items:center;}
.all-categories{position:relative;cursor:pointer;display:flex;align-items:center;color:white;padding:12px 20px;}
.categories-menu{position:absolute;top:100%;right:0;width:200px;background:white;box-shadow:0 5px 15px rgba(0,0,0,0.1);border-radius:4px;z-index:100;display:none;}
.categories-menu.active{display:block;}
.categories-menu ul{list-style:none;padding:10px 0;}
.categories-menu li{padding:10px 20px;cursor:pointer;transition:0.3s;}
.categories-menu li:hover{background-color:var(--light-color);}
.main-nav ul{display:flex;list-style:none;}
.main-nav li{position:relative;}
.main-nav a{display:block;color:white;text-decoration:none;padding:12px 20px;transition:0.3s;font-size:0.9rem;}
.main-nav a:hover{background-color:rgba(0,0,0,0.1);}
.products-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:20px;}
.product-card{background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.08);transition:0.3s;}
.product-card:hover{transform:translateY(-5px);box-shadow:0 8px 20px rgba(0,0,0,0.12);}
.product-card img{width:100%;height:220px;object-fit:cover;border-bottom:1px solid var(--border-color);}
.product-info{padding:10px;}
.add-to-cart{padding:5px 10px;background:var(--primary-color);color:white;border:none;border-radius:4px;cursor:pointer;}
.add-to-cart:hover{background:#c41f29;}
.cart-popup{position:fixed;top:0;right:0;width:350px;height:100vh;background:white;box-shadow:-5px 0 15px rgba(0,0,0,0.1);padding:20px;overflow-y:auto;transform:translateX(100%);transition:0.3s;z-index:1000;}
.cart-popup.active{transform:translateX(0);}
.cart-item{display:flex;margin-bottom:10px;}
.cart-item img{width:50px;height:50px;object-fit:cover;margin-left:10px;}
.cart-item-details{flex-grow:1;}
.modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:white;padding:20px;width:90%;max-width:400px;border-radius:8px;transition:0.3s;z-index:1100;}
.modal.active{transform:translate(-50%,-50%) scale(1);}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:1050;}
.overlay.active{display:block;}
button{cursor:pointer;}
@media(max-width:1024px){.products-grid{grid-template-columns:repeat(3,1fr);}}
@media(max-width:768px){.products-grid{grid-template-columns:repeat(2,1fr);}}
@media(max-width:480px){.products-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<header>
    <div class="top-header">
        <div class="container">
            <div>تلفن: 09123456789 | ایمیل: info@halston.com</div>
            <div class="top-header-links">
                <a onclick="showGuide()">راهنما</a>
                <a onclick="showAccount()">حساب کاربری</a>
                <a onclick="showTracking()">پیگیری سفارش</a>
                <a onclick="showWishlist()">علاقه‌مندی‌ها</a>
            </div>
        </div>
    </div>
    <div class="main-header">
        <div class="container">
            <div class="logo" onclick="goToHome()">Halston</div>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="جستجوی محصولات...">
                <button>🔍</button>
            </div>
            <div class="header-actions">
                <div class="header-action cart-wrapper" onclick="toggleCart()">
                    <span>🛒</span>
                    <div class="cart-count" id="cart-count">0</div>
                    <div>سبد خرید</div>
                </div>
            </div>
        </div>
    </div>
    <nav class="main-nav">
        <div class="container">
            <div class="all-categories" onclick="toggleCategories()">دسته‌بندی‌ها ▼
                <div class="categories-menu" id="categories-menu">
                    <ul>
                        <li onclick="showAllProducts()">همه محصولات</li>
                        <li onclick="filterProducts('لباس')">لباس</li>
                        <li onclick="filterProducts('کفش')">کفش</li>
                        <li onclick="filterProducts('اکسسوری')">اکسسوری</li>
                    </ul>
                </div>
            </div>
            <ul>
                <li><a href="#">خانه</a></li>
                <li><a href="#">محصولات</a></li>
                <li><a href="#">درباره ما</a></li>
                <li><a href="#">تماس با ما</a></li>
            </ul>
        </div>
    </nav>
</header>

<section class="products-section container">
    <div class="section-header">
        <h2 class="section-title">محصولات</h2>
        <span class="view-all" onclick="showAllProducts()">مشاهده همه</span>
    </div>
    <div class="products-grid" id="products-grid"></div>
</section>

<div class="cart-popup" id="cart-popup">
    <div class="cart-header">
        <h3>سبد خرید</h3>
        <button class="close-cart" onclick="closeCart()">✖</button>
    </div>
    <div id="cart-items"></div>
    <div class="cart-total">
        <span>جمع کل:</span>
        <span id="cart-total">0 تومان</span>
    </div>
    <button onclick="openUserModal()">ثبت سفارش</button>
</div>

<div class="modal" id="user-modal">
    <h3>اطلاعات مشتری</h3>
    <button onclick="closeUserModal()">✖</button>
    <form onsubmit="event.preventDefault(); generateInvoice();">
        <input type="text" id="name" placeholder="نام و نام خانوادگی" required>
        <input type="text" id="phone" placeholder="شماره تماس" required>
        <textarea id="address" placeholder="آدرس" required></textarea>
        <button type="submit">تولید فاکتور</button>
    </form>
</div>

<div class="modal" id="invoice-modal">
    <h3>فاکتور شما</h3>
    <button onclick="closeInvoiceModal()">✖</button>
    <div id="invoice-content"></div>
</div>

<script>
// =============== JS ===============
let cart = [];
let products = [];

// از main.py لود کن
fetch("/api/products")  // main.py باید این route بدهد
  .then(res=>res.json())
  .then(data=>{
      products = data;
      showAllProducts();
  });

function showAllProducts(){
    const grid = document.getElementById("products-grid");
    grid.innerHTML = "";
    products.forEach(p=>{
        const div = document.createElement("div");
        div.className = "product-card";
        div.innerHTML = `
            <img src="${p.img}" alt="${p.name}">
            <div class="product-info">
                <div>${p.name}</div>
                <div>${p.price.toLocaleString()} تومان</div>
                <button class="add-to-cart" onclick="addToCart(${p.id})">افزودن به سبد</button>
            </div>`;
        grid.appendChild(div);
    });
}

function addToCart(id){
    const p = products.find(x=>x.id===id);
    const item = cart.find(x=>x.id===id);
    if(item) item.qty++;
    else cart.push({...p, qty:1});
    updateCart();
}

function updateCart(){
    const cartDiv = document.getElementById("cart-items");
    const cartCount = document.getElementById("cart-count");
    const cartTotal = document.getElementById("cart-total");
    cartDiv.innerHTML = "";
    let total=0, count=0;
    cart.forEach(i=>{
        total += i.price*i.qty;
        count += i.qty;
        const div = document.createElement("div");
        div.className="cart-item";
        div.innerHTML = `
            <img src="${i.img}">
            <div class="cart-item-details">
                <div>${i.name}</div>
                <div>${i.price.toLocaleString()} × ${i.qty}</div>
                <button onclick="removeFromCart(${i.id})">حذف</button>
            </div>`;
        cartDiv.appendChild(div);
    });
    cartCount.innerText = count;
    cartTotal.innerText = total.toLocaleString() + " تومان";
}

function removeFromCart(id){
    cart = cart.filter(x=>x.id!==id);
    updateCart();
}

function toggleCart(){document.getElementById("cart-popup").classList.toggle("active"); overlay.classList.toggle("active");}
function closeCart(){document.getElementById("cart-popup").classList.remove("active"); overlay.classList.remove("active");}
function openUserModal(){document.getElementById("user-modal").classList.add("active"); overlay.classList.add("active");}
function closeUserModal(){document.getElementById("user-modal").classList.remove("active"); overlay.classList.remove("active");}
function closeInvoiceModal(){document.getElementById("invoice-modal").classList.remove("active"); overlay.classList.remove("active");}
function closeAll(){closeCart(); closeUserModal(); closeInvoiceModal(); overlay.classList.remove("active");}

// تولید فاکتور و ارسال به کاربر و ادمین
function generateInvoice(){
    const name = document.getElementById("name").value;
    const phone = document.getElementById("phone").value;
    const address = document.getElementById("address").value;
    let html = `<h4>نام: ${name}</h4><h4>تلفن: ${phone}</h4><h4>آدرس: ${address}</h4>`;
    html += `<table><tr><th>محصول</th><th>قیمت</th><th>تعداد</th><th>جمع</th></tr>`;
    let total=0;
    cart.forEach(i=>{
        let sum = i.price*i.qty;
        total += sum;
        html += `<tr><td>${i.name}</td><td>${i.price.toLocaleString()}</td><td>${i.qty}</td><td>${sum.toLocaleString()}</td></tr>`;
    });
    html += `<tr><th colspan="3">جمع کل</th><th>${total.toLocaleString()}</th></tr></table>`;
    document.getElementById("invoice-content").innerHTML = html;
    closeUserModal();
    document.getElementById("invoice-modal").classList.add("active");
    overlay.classList.add("active");

    // ارسال به main.py (ادمین)
    fetch("/api/send_invoice",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({name, phone, address, cart})
    });
    cart=[];
    updateCart();
}
</script>

</body>
</html>
