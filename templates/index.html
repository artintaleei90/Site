<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halston Shop</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- ================= Header ================= -->
<header>
    <div class="top-header">
        <span>ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§: 09128883343</span>
        <div>
            <a href="#" id="favorites-btn">â¤ï¸ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</a>
            <a href="#" id="cart-btn">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ <span class="cart-count" id="cart-count">0</span></a>
        </div>
    </div>
    <div class="main-header">
        <div class="logo">Halston Shop</div>
        <div class="search-bar">
            <input type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ...">
            <button>ğŸ”</button>
        </div>
    </div>
</header>

<!-- ================= Hero Slider ================= -->
<section class="hero-slider">
    <div class="hero-slide active" style="background-image:url('https://raw.githubusercontent.com/artintaleei90/Site/main/slider1.jpeg');">
        <div class="slide-content">
            <h2>Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
            <p>Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ Ø¯Ø± Halston Shop</p>
        </div>
    </div>
    <div class="hero-slide" style="background-image:url('https://raw.githubusercontent.com/artintaleei90/Site/main/slider2.jpeg');">
        <div class="slide-content">
            <h2>ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡</h2>
            <p>Ù‡Ù…ÛŒÙ† Ø­Ø§Ù„Ø§ Ø³ÙØ§Ø±Ø´ Ø¯Ù‡ÛŒØ¯ Ùˆ Ø§Ø² ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯!</p>
        </div>
    </div>
    <button class="nav-btn prev-btn">â®</button>
    <button class="nav-btn next-btn">â¯</button>
</section>

<!-- ================= Products ================= -->
<section class="products-section">
    <div class="section-header">
        <h2 class="section-title">Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
    </div>
    <div class="products-grid" id="products-grid">
        <!-- Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø§ JS Ø§Ø² /api/products Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
    </div>
</section>

<!-- ================= Modal ================= -->
<div class="overlay" id="overlay"></div>
<div class="modal" id="product-modal">
    <h3 id="modal-title">Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„</h3>
    <img id="modal-image" src="" alt="" style="width:100%; border-radius:6px; margin-bottom:10px;">
    <p id="modal-desc">ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„</p>
    <label for="modal-quantity">ØªØ¹Ø¯Ø§Ø¯:</label>
    <input type="number" id="modal-quantity" value="1" min="1">
    <button id="modal-add">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
</div>

<!-- ================= Scripts ================= -->
<script>
let products = {};
let cart = {};

const productsGrid = document.getElementById('products-grid');
const overlay = document.getElementById('overlay');
const modal = document.getElementById('product-modal');
const modalTitle = document.getElementById('modal-title');
const modalImage = document.getElementById('modal-image');
const modalDesc = document.getElementById('modal-desc');
const modalQuantity = document.getElementById('modal-quantity');
const modalAdd = document.getElementById('modal-add');
const cartCount = document.getElementById('cart-count');
let currentProduct = null;

// Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ø² main.py
fetch('/api/products')
.then(res => res.json())
.then(data => {
    products = data;
    renderProducts();
});

function renderProducts() {
    productsGrid.innerHTML = '';
    for (let code in products) {
        const p = products[code];
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
            <img class="product-image" src="${p.image}" alt="${p.name}">
            <div class="product-info">
                <div class="product-name">${p.name}</div>
                <div class="product-price">${p.price} ØªÙˆÙ…Ø§Ù†</div>
                <div class="product-actions">
                    <button class="add-to-cart">Ø§ÙØ²ÙˆØ¯Ù†</button>
                </div>
            </div>
        `;
        card.querySelector('.product-image').addEventListener('click', () => openModal(code));
        card.querySelector('.add-to-cart').addEventListener('click', () => openModal(code));
        productsGrid.appendChild(card);
    }
}

function openModal(code) {
    currentProduct = code;
    const p = products[code];
    modalTitle.textContent = p.name;
    modalImage.src = p.image;
    modalDesc.textContent = p.name; // ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ÙˆØªØ§Ù‡
    modalQuantity.value = 1;
    modal.classList.add('active');
    overlay.classList.add('active');
}

function closeModal() {
    modal.classList.remove('active');
    overlay.classList.remove('active');
}

overlay.addEventListener('click', closeModal);
modalAdd.addEventListener('click', () => {
    const qty = parseInt(modalQuantity.value);
    if (cart[currentProduct]) cart[currentProduct] += qty;
    else cart[currentProduct] = qty;
    cartCount.textContent = Object.values(cart).reduce((a,b)=>a+b,0);
    closeModal();
});

// Ú†Ø§Ù¾ ÙØ§Ú©ØªÙˆØ±
function printInvoice() {
    const name = prompt("Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
    const phone = prompt("Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:");
    const address = prompt("Ø¢Ø¯Ø±Ø³:");
    const cartArray = [];
    for (let code in cart) {
        cartArray.push({code: code, count: cart[code]});
    }
    fetch('/api/order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name, phone, address, cart: cartArray})
    }).then(res => res.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'invoice.pdf';
        a.click();
    });
}
</script>

<!-- ================= Cart Print Button ================= -->
<div style="position:fixed; bottom:20px; left:20px; z-index:1002;">
    <button onclick="printInvoice()" style="background: #e91e63; color:white; border:none; padding:12px 20px; border-radius:8px; font-size:1rem; cursor:pointer;">Ú†Ø§Ù¾ ÙØ§Ú©ØªÙˆØ±</button>
</div>

</body>
</html>
