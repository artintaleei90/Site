<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù‡Ø§Ù„Ø³ØªÙˆÙ†</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Ù‡Ø¯Ø± -->
    <header class="header">
        <div class="logo">ğŸŒ¸ Ù‡Ø§Ù„Ø³ØªÙˆÙ† Ø´Ø§Ù¾</div>
        <div class="cart-icon" onclick="openCart()">
            ğŸ›’ <span id="cart-count">Û°</span>
        </div>
    </header>

    <!-- Ø¨Ø®Ø´ Ù…Ø­ØµÙˆÙ„Ø§Øª -->
    <main>
        {% for category, items in products.items() %}
        <section class="category-section">
            <h2 class="category-title">{{ category }}</h2>
            <div class="slider-container">
                <button class="slider-btn left" onclick="slideLeft('{{ loop.index }}')">â€¹</button>
                <div id="slider-{{ loop.index }}" class="products-slider">
                    {% for item in items %}
                    <div class="product-card">
                        <img src="{{ item.image }}" alt="{{ item.name }}">
                        <h3>{{ item.name }}</h3>
                        <p class="price">{{ "{:,}".format(item.price) }} ØªÙˆÙ…Ø§Ù†</p>
                        <button onclick="addToCart('{{ item.code }}', '{{ item.name }}', '{{ item.price }}')">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯</button>
                    </div>
                    {% endfor %}
                </div>
                <button class="slider-btn right" onclick="slideRight('{{ loop.index }}')">â€º</button>
            </div>
        </section>
        {% endfor %}
    </main>

    <!-- Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ -->
    <div id="cart-modal" class="cart-modal">
        <div class="cart-content">
            <h2>ğŸ›ï¸ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§</h2>
            <ul id="cart-items"></ul>
            <div class="cart-footer">
                <p>Ø¬Ù…Ø¹ Ú©Ù„: <span id="total-price">Û°</span> ØªÙˆÙ…Ø§Ù†</p>
                <button id="checkout-btn" onclick="checkout()">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
                <button class="close-btn" onclick="closeCart()">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <script>
        let cart = [];

        function addToCart(code, name, price) {
            cart.push({ code, name, price: parseInt(price) });
            document.getElementById("cart-count").innerText = cart.length;
            renderCart();
        }

        function renderCart() {
            const cartList = document.getElementById("cart-items");
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            cartList.innerHTML = "";
            cart.forEach(item => {
                const li = document.createElement("li");
                li.innerHTML = `${item.name} - ${item.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
                cartList.appendChild(li);
            });
            document.getElementById("total-price").innerText = total.toLocaleString();
        }

        function openCart() {
            document.getElementById("cart-modal").style.display = "flex";
        }

        function closeCart() {
            document.getElementById("cart-modal").style.display = "none";
        }

        function checkout() {
            fetch("/checkout", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ cart })
            })
            .then(res => res.json())
            .then(data => {
                alert("âœ… Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯ Ùˆ ÙØ§Ú©ØªÙˆØ± Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!");
                cart = [];
                document.getElementById("cart-count").innerText = "Û°";
                renderCart();
                closeCart();
            });
        }

        function slideLeft(id) {
            document.getElementById("slider-" + id).scrollBy({ left: -300, behavior: "smooth" });
        }

        function slideRight(id) {
            document.getElementById("slider-" + id).scrollBy({ left: 300, behavior: "smooth" });
        }
    </script>
</body>
</html>
